// Top of JS file — Global data
const data = {
    "questions": [
      {
        "id": 1,
        "title": "Add Two Numbers",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/add-two-numbers/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "microsoft.png"]
      },
      {
        "id": 2,
        "title": "Copy List with Random Pointer",
        "languages": ["Java", "C++", "Python", "C"],
        "practiceLink": "https://leetcode.com/problems/copy-list-with-random-pointer/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "amazon.jpeg", "google.png"]
      },
      {
        "id": 3,
        "title": "Reorder List",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/reorder-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 4,
        "title": "Remove Nth Node From End of List",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/remove-nth-node-from-end-of-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 5,
        "title": "Flatten a Multilevel Doubly Linked List",
        "languages": ["C++", "Python", "Java"],
        "practiceLink": "https://leetcode.com/problems/flatten-a-multilevel-doubly-linked-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "amazon.jpeg", "google.png"]
      },
      {
        "id": 6,
        "title": "Swap Nodes in Pairs",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/swap-nodes-in-pairs/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg"]
      },
      {
        "id": 7,
        "title": "Partition List",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/partition-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "amazon.jpeg"]
      },
      {
        "id": 8,
        "title": "Rotate List",
        "languages": ["Java", "Python", "C"],
        "practiceLink": "https://leetcode.com/problems/rotate-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "microsoft.png"]
      },
      {
        "id": 9,
        "title": "LRU Cache",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/lru-cache/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "microsoft.png"]
      },
      {
        "id": 10,
        "title": "Sort List",
        "languages": ["C++", "Python", "Java"],
        "practiceLink": "https://leetcode.com/problems/sort-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg"]
      },
      {
        "id": 11,
        "title": "Odd Even Linked List",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/odd-even-linked-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "microsoft.png"]
      },
      {
        "id": 12,
        "title": "Next Greater Node In Linked List",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/next-greater-node-in-linked-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "Capgemini.png", "microsoft.png"]
      },
      {
        "id": 13,
        "title": "Linked List Cycle II",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/linked-list-cycle-ii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 14,
        "title": "Remove Duplicates from Sorted List II",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/remove-duplicates-from-sorted-list-ii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 15,
        "title": "Reverse Linked List II",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/reverse-linked-list-ii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg"]
      },
      {
        "id": 16,
        "title": "Design Browser History",
        "languages": ["Java", "Python", "C"],
        "practiceLink": "https://leetcode.com/problems/design-browser-history/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "amazon.jpeg"]
      },
      {
        "id": 17,
        "title": "Insertion Sort List",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/insertion-sort-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png","amazon.jpeg"]
      },
      {
        "id": 18,
        "title": "Split Linked List in Parts",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/split-linked-list-in-parts/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "microsoft.png"]
      },
      {
        "id": 19,
        "title": "Plus One Linked List",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/plus-one-linked-list/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg"]
      },
      {
        "id": 20,
        "title": "Linked List Random Node",
        "languages": ["Java", "Python", "C"],
        "practiceLink": "https://leetcode.com/problems/linked-list-random-node/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "google.png"]
      }
    ]
  };
  // Make sure this runs AFTER DOM is loaded
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize pagination and render first page
    renderPagination();
    goToPage(1);
    initializeTableFunctionality();
  });
  
  // Helper function to get paginated questions
  function getPaginatedQuestions(pageNumber) {
    const questionsPerPage = 5;
    const startIndex = (pageNumber - 1) * questionsPerPage;
    const endIndex = startIndex + questionsPerPage;
    return data.questions.slice(startIndex, endIndex);
  }
  
  function renderTable(questions) {
    const tbody = document.querySelector('.table tbody');
    tbody.innerHTML = ''; // Clear existing rows
  
    questions.forEach((question, index) => {
        const row = document.createElement('tr');
        if (index % 2 === 1) row.style.backgroundColor = '#f9f9f9'; // Alternate row colors
  
        row.innerHTML =
            '<td style="width: 0px">' +
            '<div class="form-check">' +
            '<input class="form-check-input review-checkbox" type="checkbox" id="check-' + question.id + '">' +
            '<label class="form-check-label" for="check-' + question.id + '"></label>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="d-flex align-items-center">' +
            '<div class="ms-4">' +
            '<div>' + question.title + '</div>' +
            '</div>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            question.languages.map(function (lang) {
                return '<div class="avatar avatar-xs">' +
                    '<img class="avatar-img" src="' + lang.toLowerCase() + '.png" alt="' + lang + '">' +
                    '</div>';
            }).join('') +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            '<div class="avatar avatar-xs" style="margin-left: 1.2vw;">' +
            '<a href="' + question.practiceLink + '">' +
            '<img class="avatar-img" src="' + question.practiceSite + '" alt="Practice site" style="' + (question.practiceSite === 'gfg.png' ? 'width: 39px; height: 23px;' : '') + '">' +
            '</a>' +
            '</div>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<select class="form-select form-select-sm border-0 status-select text-danger" style="width: auto;" data-review-link="' + question.practiceLink + '">' +
            '<option class="text-danger" value="Untouched"' + (question.status === 'Untouched' ? ' selected' : '') + '>Untouched</option>' +
            '<option class="text-warning" value="In Progress"' + (question.status === 'In Progress' ? ' selected' : '') + '>In Progress</option>' +
            '<option class="text-success" value="Completed"' + (question.status === 'Completed' ? ' selected' : '') + '>Completed</option>' +
            '<option class="text-primary" value="Review"' + (question.status === 'Review' ? ' selected' : '') + '>Review</option>' +
            '</select>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            question.companies.map(function (company) {
                return '<div class="avatar avatar-xs">' +
                    '<img class="avatar-img" src="' + company + '" alt="' + company.split('.')[0] + '">' +
                    '</div>';
            }).join('') +
            '</div>' +
            '</td>';
  
        tbody.appendChild(row);
    });
  }
  
  function renderPagination() {
    const paginationContainer = document.querySelector('.pagination');
    const questionsPerPage = 5;
    const totalPages = Math.ceil(data.questions.length / questionsPerPage);
  
    paginationContainer.innerHTML = '';
  
    // Previous button
    const prevItem = document.createElement('li');
    prevItem.className = 'page-item';
    prevItem.innerHTML = `
        <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">«</span>
        </a>
    `;
    prevItem.addEventListener('click', (e) => {
        e.preventDefault();
        const currentActive = document.querySelector('.pagination .active');
        const currentPage = currentActive ? parseInt(currentActive.textContent) : 1;
        if (currentPage > 1) {
            goToPage(currentPage - 1);
        }
    });
    paginationContainer.appendChild(prevItem);
  
    // Page numbers
    for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement('li');
        pageItem.className = 'page-item';
        if (i === 1) pageItem.classList.add('active');
  
        const pageLink = document.createElement('a');
        pageLink.className = 'page-link';
        pageLink.href = '#';
        pageLink.textContent = i;
  
        pageLink.addEventListener('click', (e) => {
            e.preventDefault();
            goToPage(i);
        });
  
        pageItem.appendChild(pageLink);
        paginationContainer.appendChild(pageItem);
    }
  
    // Next button
    const nextItem = document.createElement('li');
    nextItem.className = 'page-item';
    nextItem.innerHTML = `
        <a class="page-link" href="#" aria-label="Next">
            <span aria-hidden="true">»</span>
        </a>
    `;
    nextItem.addEventListener('click', (e) => {
        e.preventDefault();
        const currentActive = document.querySelector('.pagination .active');
        const currentPage = currentActive ? parseInt(currentActive.textContent) : 1;
        if (currentPage < totalPages) {
            goToPage(currentPage + 1);
        }
    });
    paginationContainer.appendChild(nextItem);
  }
  
  function goToPage(pageNumber) {
    const questions = getPaginatedQuestions(pageNumber);
    renderTable(questions);
    updateActivePage(pageNumber);
    initializeTableFunctionality(); // Reinitialize functionality for new rows
  }
  
  function updateActivePage(newActivePage) {
    const pageItems = document.querySelectorAll('.pagination .page-item');
    pageItems.forEach((item, index) => {
        // Skip prev/next buttons (first and last elements)
        if (index > 0 && index < pageItems.length - 1) {
            item.classList.remove('active');
            if (index === newActivePage) {
                item.classList.add('active');
            }
        }
    });
  }
  
  function initializeTableFunctionality() {
    const completedCountElement = document.getElementById('completedCount');
    const searchInput = document.getElementById('questionSearch');
  
    function updateCompletedCount() {
        const statusDropdowns = document.querySelectorAll('.status-select');
        const completedCount = Array.from(statusDropdowns).filter(function (select) {
            return select.value === 'Completed';
        }).length;
        completedCountElement.textContent = completedCount + ' out of ' + statusDropdowns.length + ' programs completed';
    }
  
    function applyColorClass(select) {
        select.classList.remove('text-danger', 'text-warning', 'text-success', 'text-primary');
        switch (select.value) {
            case 'Untouched': select.classList.add('text-danger'); break;
            case 'In Progress': select.classList.add('text-warning'); break;
            case 'Completed': select.classList.add('text-success'); break;
            case 'Review': select.classList.add('text-primary'); break;
        }
    }
  
    function handleStatusChange(select, index) {
        const value = select.value;
        const checkboxes = document.querySelectorAll('.review-checkbox');
        const checkbox = checkboxes[index];
  
        checkbox.checked = (value === 'Completed' || value === 'Review');
  
        updateCompletedCount();
        applyColorClass(select);
  
        if (value === 'Review') {
            const reviewLink = select.getAttribute('data-review-link');
            if (reviewLink) window.open(reviewLink, '_blank');
        }
    }
  
    const statusDropdowns = document.querySelectorAll('.status-select');
    const checkboxes = document.querySelectorAll('.review-checkbox');
    statusDropdowns.forEach(function (select, index) {
        applyColorClass(select);
        if (select.value === 'Completed' || select.value === 'Review') checkboxes[index].checked = true;
        select.addEventListener('change', function () {
            handleStatusChange(select, index);
        });
    });
  
    updateCompletedCount();
  
    if (searchInput) {
        searchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('.table tbody tr');
  
            tableRows.forEach(function (row) {
                const questionCell = row.cells[1];
                const titleDiv = questionCell.querySelector('div.ms-4 > div');
                const questionText = titleDiv ? titleDiv.textContent.toLowerCase() : "";
  
                const statusSelect = row.querySelector('.status-select');
                const statusText = statusSelect ? statusSelect.value.toLowerCase() : "";
  
                const companyCell = row.cells[row.cells.length - 1];
                const companyImgs = companyCell ? companyCell.querySelectorAll('img') : [];
                let companyMatch = false;
  
                companyImgs.forEach(function (img) {
                    const src = img.getAttribute('src').toLowerCase();
                    if (src.includes(searchTerm)) companyMatch = true;
                });
  
                const matches = questionText.includes(searchTerm) || statusText.includes(searchTerm) || companyMatch;
                row.style.display = matches ? '' : 'none';
            });
        });
    }
  }
  