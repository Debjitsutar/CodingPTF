// Top of JS file — Global data
const data = {
    "questions": [
      {
        "id": 1,
        "title": "Word Ladder II (BFS + Backtracking)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/word-ladder-ii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 2,
        "title": "Minimum Window Substring (Sliding Window + Graph)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-window-substring/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 3,
        "title": "Critical Connections in a Network (Tarjan's Algorithm)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/critical-connections-in-a-network/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "google.png", "amazon.jpeg"]
      },
      {
        "id": 4,
        "title": "Minimum Cost to Reach City With Discounts (Modified Dijkstra's)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-cost-to-reach-city-with-discounts/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "Capgemini.jpg"]
      },
      {
        "id": 5,
        "title": "Bus Routes (BFS on Routes)",
        "languages": ["C++", "Python", "Java"],
        "practiceLink": "https://leetcode.com/problems/bus-routes/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "microsoft.png", "tcs.jpg"]
      },
      {
        "id": 6,
        "title": "Parallel Courses III (Topological Sort + DP)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/parallel-courses-iii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "microsoft.png", "accenture.png"]
      },
      {
        "id": 7,
        "title": "Shortest Path in a Grid with Obstacles Elimination (BFS + State)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/shortest-path-in-a-grid-with-obstacles-elimination/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 8,
        "title": "Reachable Nodes In Subdivided Graph (Advanced Dijkstra's)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/reachable-nodes-in-subdivided-graph/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "google.png", "amazon.jpeg"]
      },
      {
        "id": 9,
        "title": "Minimum Number of Days to Disconnect Island (Articulation Points)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-number-of-days-to-disconnect-island/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 10,
        "title": "Maximum Path Quality of a Graph (Backtracking + State)",
        "languages": ["C++", "Python", "Java"],
        "practiceLink": "https://leetcode.com/problems/maximum-path-quality-of-a-graph/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "Capgemini.jpg"]
      },
      {
        "id": 11,
        "title": "Find the City With the Smallest Number of Neighbors (Floyd-Warshall)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/find-the-city-with-the-smallest-number-of-neighbors-at-a-threshold-distance/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "google.png", "tcs.jpg"]
      },
      {
        "id": 12,
        "title": "Number of Ways to Arrive at Destination (Dijkstra's + DP)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/number-of-ways-to-arrive-at-destination/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 13,
        "title": "Strange Printer II (Graph Coloring + Topological Sort)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/strange-printer-ii/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 14,
        "title": "Minimum Degree of a Connected Trio in a Graph (Graph Theory)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-degree-of-a-connected-trio-in-a-graph/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "google.png", "accenture.png"]
      },
      {
        "id": 15,
        "title": "Grid Illumination (Graph + Hashing)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/grid-illumination/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "Capgemini.jpg"]
      },
      {
        "id": 16,
        "title": "Minimum Number of Visited Cells in a Grid (BFS + Priority Queue)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/minimum-number-of-visited-cells-in-a-grid/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "microsoft.png", "amazon.jpeg"]
      },
      {
        "id": 17,
        "title": "Minimum Moves to Move a Box to Target (BFS + State Machine)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-moves-to-move-a-box-to-their-target-location/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["microsoft.png", "amazon.jpeg", "netflix.png"]
      },
      {
        "id": 18,
        "title": "Maximum Strictly Increasing Cells in a Matrix (Memoization + Graph)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/maximum-strictly-increasing-cells-in-a-matrix/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "amazon.jpeg", "tcs.jpg"]
      },
      {
        "id": 19,
        "title": "Minimum Reverse Operations (BFS + Balanced Tree)",
        "languages": ["Java", "C++", "Python"],
        "practiceLink": "https://leetcode.com/problems/minimum-reverse-operations/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["amazon.jpeg", "google.png", "microsoft.png"]
      },
      {
        "id": 20,
        "title": "Check if Point Is Reachable (GCD + Graph Theory)",
        "languages": ["Java", "Python", "C++"],
        "practiceLink": "https://leetcode.com/problems/check-if-point-is-reachable/",
        "practiceSite": "leetcode.png",
        "status": "Untouched",
        "companies": ["google.png", "microsoft.png", "Capgemini.jpg"]
      }
    ]
  };
  // Make sure this runs AFTER DOM is loaded
document.addEventListener("DOMContentLoaded", function () {
    // Initialize pagination and render first page
    renderPagination();
    goToPage(1);
    initializeTableFunctionality();
});

// Helper function to get paginated questions
function getPaginatedQuestions(pageNumber) {
    const questionsPerPage = 5;
    const startIndex = (pageNumber - 1) * questionsPerPage;
    const endIndex = startIndex + questionsPerPage;
    return data.questions.slice(startIndex, endIndex);
}

function renderTable(questions) {
    const tbody = document.querySelector('.table tbody');
    tbody.innerHTML = ''; // Clear existing rows

    questions.forEach((question, index) => {
        const row = document.createElement('tr');
        if (index % 2 === 1) row.style.backgroundColor = '#f9f9f9'; // Alternate row colors

        row.innerHTML =
            '<td style="width: 0px">' +
            '<div class="form-check">' +
            '<input class="form-check-input review-checkbox" type="checkbox" id="check-' + question.id + '">' +
            '<label class="form-check-label" for="check-' + question.id + '"></label>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="d-flex align-items-center">' +
            '<div class="ms-4">' +
            '<div>' + question.title + '</div>' +
            '</div>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            question.languages.map(function (lang) {
                return '<div class="avatar avatar-xs">' +
                    '<img class="avatar-img" src="' + lang.toLowerCase() + '.png" alt="' + lang + '">' +
                    '</div>';
            }).join('') +
            '</div>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            '<div class="avatar avatar-xs" style="margin-left: 1.2vw;">' +
            '<a href="' + question.practiceLink + '">' +
            '<img class="avatar-img" src="' + question.practiceSite + '" alt="Practice site" style="' + (question.practiceSite === 'gfg.png' ? 'width: 39px; height: 23px;' : '') + '">' +
            '</a>' +
            '</div>' +
            '</div>' +
            '</td>' +
            '<td>' +
            '<select class="form-select form-select-sm border-0 status-select text-danger" style="width: auto;" data-review-link="' + question.practiceLink + '">' +
            '<option class="text-danger" value="Untouched"' + (question.status === 'Untouched' ? ' selected' : '') + '>Untouched</option>' +
            '<option class="text-warning" value="In Progress"' + (question.status === 'In Progress' ? ' selected' : '') + '>In Progress</option>' +
            '<option class="text-success" value="Completed"' + (question.status === 'Completed' ? ' selected' : '') + '>Completed</option>' +
            '<option class="text-primary" value="Review"' + (question.status === 'Review' ? ' selected' : '') + '>Review</option>' +
            '</select>' +
            '</td>' +
            '<td>' +
            '<div class="avatar-group">' +
            question.companies.map(function (company) {
                return '<div class="avatar avatar-xs">' +
                    '<img class="avatar-img" src="' + company + '" alt="' + company.split('.')[0] + '">' +
                    '</div>';
            }).join('') +
            '</div>' +
            '</td>';

        tbody.appendChild(row);
    });
}

function renderPagination() {
    const paginationContainer = document.querySelector('.pagination');
    const questionsPerPage = 5;
    const totalPages = Math.ceil(data.questions.length / questionsPerPage);

    paginationContainer.innerHTML = '';

    // Previous button
    const prevItem = document.createElement('li');
    prevItem.className = 'page-item';
    prevItem.innerHTML = `
        <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">«</span>
        </a>
    `;
    prevItem.addEventListener('click', (e) => {
        e.preventDefault();
        const currentActive = document.querySelector('.pagination .active');
        const currentPage = currentActive ? parseInt(currentActive.textContent) : 1;
        if (currentPage > 1) {
            goToPage(currentPage - 1);
        }
    });
    paginationContainer.appendChild(prevItem);

    // Page numbers
    for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement('li');
        pageItem.className = 'page-item';
        if (i === 1) pageItem.classList.add('active');

        const pageLink = document.createElement('a');
        pageLink.className = 'page-link';
        pageLink.href = '#';
        pageLink.textContent = i;

        pageLink.addEventListener('click', (e) => {
            e.preventDefault();
            goToPage(i);
        });

        pageItem.appendChild(pageLink);
        paginationContainer.appendChild(pageItem);
    }

    // Next button
    const nextItem = document.createElement('li');
    nextItem.className = 'page-item';
    nextItem.innerHTML = `
        <a class="page-link" href="#" aria-label="Next">
            <span aria-hidden="true">»</span>
        </a>
    `;
    nextItem.addEventListener('click', (e) => {
        e.preventDefault();
        const currentActive = document.querySelector('.pagination .active');
        const currentPage = currentActive ? parseInt(currentActive.textContent) : 1;
        if (currentPage < totalPages) {
            goToPage(currentPage + 1);
        }
    });
    paginationContainer.appendChild(nextItem);
}

function goToPage(pageNumber) {
    const questions = getPaginatedQuestions(pageNumber);
    renderTable(questions);
    updateActivePage(pageNumber);
    initializeTableFunctionality(); // Reinitialize functionality for new rows
}

function updateActivePage(newActivePage) {
    const pageItems = document.querySelectorAll('.pagination .page-item');
    pageItems.forEach((item, index) => {
        // Skip prev/next buttons (first and last elements)
        if (index > 0 && index < pageItems.length - 1) {
            item.classList.remove('active');
            if (index === newActivePage) {
                item.classList.add('active');
            }
        }
    });
}

function initializeTableFunctionality() {
    const completedCountElement = document.getElementById('completedCount');
    const searchInput = document.getElementById('questionSearch');

    function updateCompletedCount() {
        const statusDropdowns = document.querySelectorAll('.status-select');
        const completedCount = Array.from(statusDropdowns).filter(function (select) {
            return select.value === 'Completed';
        }).length;
        completedCountElement.textContent = completedCount + ' out of ' + statusDropdowns.length + ' programs completed';
    }

    function applyColorClass(select) {
        select.classList.remove('text-danger', 'text-warning', 'text-success', 'text-primary');
        switch (select.value) {
            case 'Untouched': select.classList.add('text-danger'); break;
            case 'In Progress': select.classList.add('text-warning'); break;
            case 'Completed': select.classList.add('text-success'); break;
            case 'Review': select.classList.add('text-primary'); break;
        }
    }

    function handleStatusChange(select, index) {
        const value = select.value;
        const checkboxes = document.querySelectorAll('.review-checkbox');
        const checkbox = checkboxes[index];

        checkbox.checked = (value === 'Completed' || value === 'Review');

        updateCompletedCount();
        applyColorClass(select);

        if (value === 'Review') {
            const reviewLink = select.getAttribute('data-review-link');
            if (reviewLink) window.open(reviewLink, '_blank');
        }
    }

    const statusDropdowns = document.querySelectorAll('.status-select');
    const checkboxes = document.querySelectorAll('.review-checkbox');
    statusDropdowns.forEach(function (select, index) {
        applyColorClass(select);
        if (select.value === 'Completed' || select.value === 'Review') checkboxes[index].checked = true;
        select.addEventListener('change', function () {
            handleStatusChange(select, index);
        });
    });

    updateCompletedCount();

    if (searchInput) {
        searchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('.table tbody tr');

            tableRows.forEach(function (row) {
                const questionCell = row.cells[1];
                const titleDiv = questionCell.querySelector('div.ms-4 > div');
                const questionText = titleDiv ? titleDiv.textContent.toLowerCase() : "";

                const statusSelect = row.querySelector('.status-select');
                const statusText = statusSelect ? statusSelect.value.toLowerCase() : "";

                const companyCell = row.cells[row.cells.length - 1];
                const companyImgs = companyCell ? companyCell.querySelectorAll('img') : [];
                let companyMatch = false;

                companyImgs.forEach(function (img) {
                    const src = img.getAttribute('src').toLowerCase();
                    if (src.includes(searchTerm)) companyMatch = true;
                });

                const matches = questionText.includes(searchTerm) || statusText.includes(searchTerm) || companyMatch;
                row.style.display = matches ? '' : 'none';
            });
        });
    }
}
  